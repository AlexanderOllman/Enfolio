{% extends "admin/base_admin.html" %}

{% block styles %}
{{ super() }}
<style>
    /* Main styles from the new dashboard */
    * {
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background-color: #e7ecf0;
    }

    /* Main content */
    .admin-main {
        padding: 30px;
        overflow-y: auto;
        background-color: #e7ecf0;
    }

    /* Header styles */
    .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .greeting {
        font-size: 28px;
        font-weight: bold;
        color: #111;
    }

    .header-icons {
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .header-icon {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #004225;
        background-color: white;
        border-radius: 50%;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .header-icon:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        background-color: #004225;
        color: white;
    }

    /* Stats cards container */
    .stats-container {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    /* Dashboard sections layout */
    .dashboard-layout {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
    }

    .dashboard-left {
        flex: 2;
        min-width: 300px;
    }

    .dashboard-right {
        flex: 1;
        min-width: 280px;
    }

    /* Fix for calendar grid */
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(53, 1fr);
        grid-template-rows: repeat(7, 1fr);
        gap: 3px;
        margin-bottom: 4px;
    }

    /* Make legend colors match the calendar grid */
    .legend-color.level-1 {
        background-color: #c6e48b;
    }
    
    .legend-color.level-2 {
        background-color: #7bc96f;
    }
    
    .legend-color.level-3 {
        background-color: #239a3b;
    }
    
    .legend-color.level-4 {
        background-color: #004225;
    }
    
    /* Responsive adjustments */
    @media (max-width: 992px) {
        .dashboard-layout {
            flex-direction: column;
        }
        
        .dashboard-left, .dashboard-right {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="admin-header">
    <h1 class="greeting">Welcome back, {{ current_user.username }}!</h1>
    <div class="header-icons">
        <a href="{{ url_for('main.index') }}" class="header-icon" title="View Site">
            <i class="bi bi-eye"></i>
        </a>
        <a href="{{ url_for('main.create_new') }}" class="header-icon" title="Create New">
            <i class="bi bi-plus-circle"></i>
        </a>
        <a href="{{ url_for('auth.logout') }}" class="header-icon" title="Logout">
            <i class="bi bi-box-arrow-right"></i>
        </a>
    </div>
</div>

<!-- Stats Cards -->
<div class="stats-container">
    <div class="stat-card">
        <div class="card-header">
            <div class="card-icon">
                <i class="bi bi-code-square"></i>
            </div>
            <div class="more-options">
                <i class="bi bi-three-dots-vertical"></i>
            </div>
        </div>
        <div class="stat-value">{{ content|selectattr('type', 'equalto', 'project')|list|length }}</div>
        <div class="stat-label">Projects</div>
    </div>
    <div class="stat-card">
        <div class="card-header">
            <div class="card-icon">
                <i class="bi bi-briefcase"></i>
            </div>
            <div class="more-options">
                <i class="bi bi-three-dots-vertical"></i>
            </div>
        </div>
        <div class="stat-value">{{ content|selectattr('type', 'equalto', 'experience')|list|length }}</div>
        <div class="stat-label">Experiences</div>
    </div>
    <div class="stat-card">
        <div class="card-header">
            <div class="card-icon">
                <i class="bi bi-file-text"></i>
            </div>
            <div class="more-options">
                <i class="bi bi-three-dots-vertical"></i>
            </div>
        </div>
        <div class="stat-value">{{ content|selectattr('type', 'equalto', 'blog')|list|length }}</div>
        <div class="stat-label">Blog Posts</div>
    </div>
    <div class="stat-card">
        <div class="card-header">
            <div class="card-icon">
                <i class="bi bi-journal"></i>
            </div>
            <div class="more-options">
                <i class="bi bi-three-dots-vertical"></i>
            </div>
        </div>
        <div class="stat-value">{{ journal_entries|length }}</div>
        <div class="stat-label">Journal Entries</div>
    </div>
</div>

<!-- Dashboard Layout -->
<div class="dashboard-layout">
    <!-- Left Column -->
    <div class="dashboard-left">
        <!-- GitHub-style Activity Calendar -->
        <div class="github-calendar">
            <div class="calendar-header">
                <h2 class="calendar-title">Contribution Activity</h2>
                <div class="calendar-legend">
                    <div class="legend-item">
                        <span>Less</span>
                        <div class="legend-color legend-less"></div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color level-1"></div>
                        <div class="legend-color level-2"></div>
                        <div class="legend-color level-3"></div>
                        <div class="legend-color level-4"></div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-more"></div>
                        <span>More</span>
                    </div>
                </div>
            </div>
            
            <div class="calendar-grid">
                <!-- Generate calendar squares dynamically in production -->
                {% for week in range(1, 53) %}
                    {% for day in range(1, 8) %}
                        {% set level = (((week + day) % 5)) %}
                        <div class="calendar-day level-{{ level }}"></div>
                    {% endfor %}
                {% endfor %}
            </div>
            
            <div class="calendar-months">
                <div>Jan</div>
                <div>Feb</div>
                <div>Mar</div>
                <div>Apr</div>
                <div>May</div>
                <div>Jun</div>
                <div>Jul</div>
                <div>Aug</div>
                <div>Sep</div>
                <div>Oct</div>
                <div>Nov</div>
                <div>Dec</div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="activity-container">
            <h2 class="activity-title">Recent Activity</h2>
            {% if recent_content %}
                {% for item in recent_content %}
                <div class="activity-item">
                    <div class="activity-avatar">
                        {% if item.type == 'project' %}
                            <i class="bi bi-code-square"></i>
                        {% elif item.type == 'experience' %}
                            <i class="bi bi-briefcase"></i>
                        {% elif item.type == 'blog' %}
                            <i class="bi bi-file-text"></i>
                        {% else %}
                            <i class="bi bi-journal"></i>
                        {% endif %}
                    </div>
                    <div class="activity-content">
                        <div class="activity-title-text">{{ item.title }}</div>
                        <div class="activity-subtitle">{{ item.type|title }} Â· {{ item.date_modified.strftime('%B %d, %Y') }}</div>
                    </div>
                    <div class="activity-status {% if item.status == 'published' %}published{% else %}draft{% endif %}">
                        {% if item.status == 'published' %}Published{% else %}Draft{% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <i class="bi bi-inbox"></i>
                    <p>No recent activity to display</p>
                    <a href="{{ url_for('main.create_new') }}?type=project" class="view-all-btn">
                        Create Something New
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Right Column -->
    <div class="dashboard-right">
        <!-- Quick Actions -->
        <div class="todo-container">
            <h2 class="todo-title">Quick Actions</h2>
            <a href="{{ url_for('main.create_new') }}?type=project" class="todo-item">
                <div class="todo-icon">
                    <i class="bi bi-code-square"></i>
                </div>
                <div class="todo-content">
                    <div class="todo-task">New Project</div>
                    <div class="todo-description">Add a project to your portfolio</div>
                </div>
            </a>
            <a href="{{ url_for('main.create_new') }}?type=experience" class="todo-item">
                <div class="todo-icon">
                    <i class="bi bi-briefcase"></i>
                </div>
                <div class="todo-content">
                    <div class="todo-task">New Experience</div>
                    <div class="todo-description">Add work or education experience</div>
                </div>
            </a>
            <a href="{{ url_for('main.create_new') }}?type=blog" class="todo-item">
                <div class="todo-icon">
                    <i class="bi bi-file-text"></i>
                </div>
                <div class="todo-content">
                    <div class="todo-task">New Blog Post</div>
                    <div class="todo-description">Share your thoughts with the world</div>
                </div>
            </a>
            <a href="{{ url_for('main.create_new') }}?type=journal" class="todo-item">
                <div class="todo-icon">
                    <i class="bi bi-journal-plus"></i>
                </div>
                <div class="todo-content">
                    <div class="todo-task">New Journal Entry</div>
                    <div class="todo-description">Document your journey</div>
                </div>
            </a>
        </div>

        <!-- Journal Entries -->
        <div class="journal-container">
            <h2 class="journal-title">Recent Journal Entries</h2>
            {% if recent_journal_entries %}
                {% for entry in recent_journal_entries[:3] %}
                <div class="journal-item">
                    <div class="journal-meta">
                        <strong>{{ entry.related_content.title }}</strong>
                        <small>{{ entry.date_created.strftime('%B %d') }}</small>
                    </div>
                    <div class="journal-content">
                        {{ entry.content[:100] }}{% if entry.content|length > 100 %}...{% endif %}
                    </div>
                </div>
                {% endfor %}
                <a href="{{ url_for('main.admin_journal') }}" class="view-all-btn">
                    View All Entries
                </a>
            {% else %}
                <div class="empty-state">
                    <i class="bi bi-journal"></i>
                    <p>No journal entries yet</p>
                    <a href="{{ url_for('main.create_new', type='journal') }}" class="view-all-btn">
                        Create First Entry
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const userMenuButton = document.getElementById('userMenuButton');
    const userMenu = document.getElementById('userMenu');
    
    // Only add event listeners if elements exist
    if (userMenuButton && userMenu) {
        userMenuButton.addEventListener('click', function(e) {
            userMenu.classList.toggle('show');
        });
        
        document.addEventListener('click', function(e) {
            if (!userMenuButton.contains(e.target) && !userMenu.contains(e.target)) {
                userMenu.classList.remove('show');
            }
        });
    }
    
    // Calendar hover effects
    const calendarDays = document.querySelectorAll('.calendar-day');
    calendarDays.forEach(day => {
        // Generate random date for demo
        const randomDate = new Date(2023, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1);
        const formattedDate = randomDate.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        
        // Generate random contributions for demo
        const level = day.classList[1].split('-')[1];
        const contributions = level === '0' ? '0' : Math.floor(Math.random() * 5 * level) + 1;
        
        // Add tooltip functionality
        day.setAttribute('title', `${contributions} contributions on ${formattedDate}`);
        
        // Enhanced hover effect
        day.addEventListener('mouseover', function() {
            this.style.transform = 'scale(1.3)';
            this.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.2)';
            this.style.zIndex = '10';
        });
        
        day.addEventListener('mouseout', function() {
            this.style.transform = '';
            this.style.boxShadow = '';
            this.style.zIndex = '';
        });
    });
    
    // Stat cards animation
    const statCards = document.querySelectorAll('.stat-card');
    statCards.forEach(card => {
        card.addEventListener('mouseover', function() {
            // Add subtle shadow pulse animation
            this.style.animation = 'shadowPulse 1.5s infinite alternate';
        });
        
        card.addEventListener('mouseout', function() {
            this.style.animation = '';
        });
    });
    
    // Define the shadow pulse animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes shadowPulse {
            0% {
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.05);
            }
            100% {
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            }
        }
    `;
    document.head.appendChild(style);
});
</script>
{% endblock %} 